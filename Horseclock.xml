<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<plugin send_to="12" group="badteeth" requires="5.06" name="HorseClock" enabled="y" id="DEADBEEFDEADBEEFDEADBEEF" sequence="100" version="0.1" language="Lua" purpose="Time tracking for horse runs" date_written="2022-01-03 17:36:35" author="badteeth"/>
<triggers>
 <trigger send_to="12" match="You tell Donk the dun horse to take you to * and he starts off at a trot." enabled="y" group="badteeth" sequence="100" script="TimerStart"/>
 <trigger send_to="12" match="Donk the dun horse slows to a stop*" enabled="y" group="badteeth" sequence="100" script="TimerStop"/>
 <trigger send_to="12" match="You mess up the rhythm of your riding*" enabled="y" group="badteeth" sequence="100" script="TimerStop"/>
 <trigger send_to="12" match="Donk the dun horse stops walking" enabled="y" group="badteeth" sequence="100" script="TimerStop"/>
</triggers>
<aliases>
 <alias send_to="12" match="hc-help" enabled="y" group="badteeth" sequence="100">
  <send>      ColourNote("white", "blue", "HorseClock tries to run/stop when the route starts/stops.")
      ColourNote("white", "blue", "Manually run it with hc-start and hc-stop.")
    </send>
 </alias>
 <alias send_to="12" match="hc-start" enabled="y" group="badteeth" sequence="100" script="TimerStart"/>
 <alias send_to="12" match="hc-stop" enabled="y" group="badteeth" sequence="100" script="TimerStop"/>
</aliases>
<script><![CDATA[
-- /world.CallPlugin ("DEADBEEFDEADBEEFDEADBEEF", "Foo")

-- when they type something
function OnPluginCommand (sText)
  return true  -- process the command
end

-- when you connect to the MUD, presumably you are not AFK
function OnPluginConnect ()
  ColourNote ("salmon", "", "Connected!")
end

local cache = {}

function TimerStart(name, line, wc)
  cache.start = utils.timer() -- utils is a global
  cache.destination = wc[1] or "somewhere"

  ColourNote("white", "blue", "Off to " .. cache.destination .. "!")
end

function TimerStop(name, line, wc)
  cache.stop = utils.timer()
  cache.diff = string.format("%.2f", cache.stop - cache.start)

  local msg = "Arrived at " .. cache.destination .. " after " .. cache.diff .. " seconds"

  if string.find(line, "mess up the rhythm") then
    msg = "Oops, you lasted " .. cache.diff .. " seconds"
  end

  ColourNote("white", "blue", msg)
end
]]></script>
